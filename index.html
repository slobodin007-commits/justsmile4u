<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Just Smile 4 You</title>
<meta name="description" content="A tiny site to make you smile."/>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- AdSense -->
<script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8042664823664503"
  crossorigin="anonymous"></script>

<style>
:root{
 --border:#e5e7eb; --text:#111827; --muted:#6b7280;
}
body{margin:0;font-family:Inter,system-ui;background:#fff;color:var(--text)}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.page{max-width:980px;width:100%}
.grid{display:grid;grid-template-columns:1fr min(420px,100%) 1fr;gap:14px}
.ad{border:1px dashed var(--border);border-radius:16px;min-height:140px;
padding:10px;display:block;color:var(--muted)}
.ad .adsbygoogle{display:block;width:100% !important}
.center{border:1px solid var(--border);border-radius:22px;padding:16px;background:#fff;position:relative}
canvas{width:100%;height:auto;display:block;border-radius:8px}
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:16px}
input{flex:1;min-width:200px;border:1px solid var(--border);border-radius:999px;padding:12px 16px;
font-weight:400;background:#fff;font-size:14px;font-family:Inter}
input:focus{outline:none;border-color:#9ca3af}
button,a{border:1px solid var(--border);border-radius:999px;padding:12px 16px;
font-weight:600;background:#fff;font-size:14px;cursor:pointer;text-decoration:none;color:var(--text);
font-family:Inter;transition:background 0.2s}
button:hover,a:hover{background:#f9fafb}
button:active{background:#f3f4f6}
#prevBtn,#nextBtn{width:44px;height:44px;padding:0;display:flex;align-items:center;justify-content:center;
font-size:20px;border-radius:50%;position:absolute;bottom:20px;z-index:10}
#prevBtn{left:20px}
#nextBtn{right:20px}
.stats{text-align:center;color:var(--muted);font-size:14px;margin-top:16px}
.language-selector{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;flex-wrap:wrap}
.language-selector select{border:1px solid var(--border);border-radius:999px;padding:8px 16px;
font-weight:400;background:#fff;font-size:14px;font-family:Inter;cursor:pointer;color:var(--text)}
.language-selector select:focus{outline:none;border-color:#9ca3af}
footer{text-align:center;font-size:12px;color:var(--muted);margin-top:20px}
footer a{color:var(--muted);text-decoration:none;padding:4px 8px;border-radius:4px}
footer a:hover{color:var(--text);background:#f9fafb}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
  .ad{display:none}
}
</style>
</head>

<body>
<div class="wrap">
<div class="page">

<div class="grid">
  <div class="ad">
    <!-- Block1 -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8042664823664503"
         data-ad-slot="2042270942"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         if (window.innerWidth > 900) {
           setTimeout(() => {
             (adsbygoogle = window.adsbygoogle || []).push({});
           }, 0);
         }
    </script>
  </div>

  <div class="center">
    <canvas id="canvas" width="900" height="900"></canvas>
    <button id="prevBtn" title="Previous image">‚óÄ</button>
    <button id="nextBtn" title="Next image">‚ñ∂</button>

    <div class="controls">
      <input id="topText" placeholder="Top text‚Ä¶" maxlength="40">
      <input id="bottomText" placeholder="Bottom text‚Ä¶" maxlength="40">
      <button id="randomBtn">‚ú® Cute caption</button>
      <button id="smileBtn">üôÇ I smiled</button>
      <button id="saveBtn">üíæ Save image</button>
      <button id="shareBtn">üì§ Share</button>
      <a href="https://buymeacoffee.com/justsmile4u" target="_blank">Made you smile? Treat them ‚òï</a>
    </div>

    <div class="language-selector">
      <span>üåê</span>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="he">◊¢◊ë◊®◊ô◊™</option>
        <option value="de">Deutsch</option>
        <option value="cs">ƒåe≈°tina</option>
      </select>
    </div>

    <div class="stats">
      Your smiles: <b id="local">0</b>
    </div>
  </div>

  <div class="ad">
    <!-- Block2 -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8042664823664503"
         data-ad-slot="3158049672"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         if (window.innerWidth > 900) {
           setTimeout(() => {
             (adsbygoogle = window.adsbygoogle || []).push({});
           }, 0);
         }
    </script>
  </div>
</div>

<footer>
<a href="about.html">About</a> ¬∑ <a href="privacy.html">Privacy</a>
</footer>

</div>
</div>

<script>
const images = [
  "img/cat-hug.png",
  "img/dog-hug.png",
  "img/axolotl-hug.png",
  "img/pomeranian-hug.png",
  "img/scottish_fold-hug.png",
  "img/dwarf_rabbit-hug.png",
  "img/guinea_pig-hug.png",
  "img/chinchilla-hug.png",
  "img/corgi-hug.png",
  "img/red_panda-hug.png",
  "img/quokka-hug.png",
  "img/fennec-hug.png",
  "img/manul-hug.png",
  "img/japanese_flying_squirrel-hug.png",
  "img/dormouse-hug.png",
  "img/ermine-hug.png",
  "img/raccoon-hug.png",
  "img/baby_seal-hug.png",
  "img/sea_otter-hug.png",
  "img/baby_penguin-hug.png",
  "img/degu-hug.png",
  "img/sloth-hug.png",
  "img/loris-hug.png",
  "img/koala-hug.png",
  "img/pygmy_marmoset-hug.png",
  "img/wombat-hug.png",
  "img/tarsier-hug.png",
  "img/tree_kangaroo-hug.png",
  "img/mini_pig-hug.png",
  "img/alpaca-hug.png",
  "img/pygmy_goat-hug.png",
  "img/highland_calf-hug.png",
  "img/panda-hug.png"
];
const cute = {
  en: [
    ["i need a hug", "just a little"],
    ["everything is fine", "probably"],
    ["sending you", "a tiny hug"],
    ["no thoughts", "only feelings"],
    ["you're doing great", "keep going"],
    ["take a breath", "you've got this"],
    ["sending love", "your way"],
    ["it's okay", "to rest"]
  ],
  ru: [
    ["–º–Ω–µ –Ω—É–∂–Ω—ã –æ–±—ä—è—Ç–∏—è", "—Å–æ–≤—Å–µ–º —á—É—Ç—å-—á—É—Ç—å"],
    ["–≤—Å—ë —Ö–æ—Ä–æ—à–æ", "–Ω–∞–≤–µ—Ä–Ω–æ–µ"],
    ["–æ—Ç–ø—Ä–∞–≤–ª—è—é —Ç–µ–±–µ", "–∫—Ä–æ—à–µ—á–Ω–æ–µ –æ–±—ä—è—Ç–∏–µ"],
    ["–Ω–µ—Ç –º—ã—Å–ª–µ–π", "—Ç–æ–ª—å–∫–æ —á—É–≤—Å—Ç–≤–∞"],
    ["—É —Ç–µ–±—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ", "–ø—Ä–æ–¥–æ–ª–∂–∞–π"],
    ["—Å–¥–µ–ª–∞–π –≤–¥–æ—Ö", "—Ç—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è"],
    ["–æ—Ç–ø—Ä–∞–≤–ª—è—é –ª—é–±–æ–≤—å", "—Ç–µ–±–µ"],
    ["–≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ", "–º–æ–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å"]
  ],
  he: [
    ["◊ê◊†◊ô ◊¶◊®◊ô◊ö ◊ó◊ô◊ë◊ï◊ß", "◊®◊ß ◊ß◊¶◊™"],
    ["◊î◊õ◊ú ◊ë◊°◊ì◊®", "◊õ◊†◊®◊ê◊î"],
    ["◊©◊ï◊ú◊ó ◊ú◊ö", "◊ó◊ô◊ë◊ï◊ß ◊ß◊ò◊ü"],
    ["◊ê◊ô◊ü ◊û◊ó◊©◊ë◊ï◊™", "◊®◊ß ◊®◊í◊©◊ï◊™"],
    ["◊ê◊™◊î ◊û◊¶◊ï◊ô◊ü", "◊™◊û◊©◊ô◊ö"],
    ["◊ß◊ó ◊†◊©◊ô◊û◊î", "◊™◊¶◊ú◊ô◊ó"],
    ["◊©◊ï◊ú◊ó ◊ê◊î◊ë◊î", "◊ì◊®◊õ◊ö"],
    ["◊ñ◊î ◊ë◊°◊ì◊®", "◊ú◊†◊ï◊ó"]
  ],
  de: [
    ["ich brauche eine umarmung", "nur ein bisschen"],
    ["alles ist gut", "wahrscheinlich"],
    ["sende dir", "eine kleine umarmung"],
    ["keine gedanken", "nur gef√ºhle"],
    ["du machst das gro√üartig", "mach weiter"],
    ["atme durch", "du schaffst das"],
    ["sende liebe", "deinen weg"],
    ["es ist okay", "sich auszuruhen"]
  ],
  cs: [
    ["pot≈ôebuji objet√≠", "jen trochu"],
    ["v≈°echno je v po≈ô√°dku", "pravdƒõpodobnƒõ"],
    ["pos√≠l√°m ti", "mal√© objet√≠"],
    ["≈æ√°dn√© my≈°lenky", "jen pocity"],
    ["jde ti to skvƒõle", "pokraƒçuj"],
    ["zhluboka se nadechni", "zvl√°dne≈° to"],
    ["pos√≠l√°m l√°sku", "tvou cestou"],
    ["je to v po≈ô√°dku", "odpoƒçinout si"]
  ]
};

// Translations
const translations = {
  en: {
    topPlaceholder: "Top text‚Ä¶",
    bottomPlaceholder: "Bottom text‚Ä¶",
    randomBtn: "‚ú® Cute caption",
    smileBtn: "üôÇ I smiled",
    saveBtn: "üíæ Save image",
    shareBtn: "üì§ Share",
    donateText: "Made you smile? Treat them ‚òï",
    stats: "Your smiles:",
    about: "About",
    privacy: "Privacy"
  },
  ru: {
    topPlaceholder: "–í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç‚Ä¶",
    bottomPlaceholder: "–ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç‚Ä¶",
    randomBtn: "‚ú® –ú–∏–ª–∞—è –ø–æ–¥–ø–∏—Å—å",
    smileBtn: "üôÇ –Ø —É–ª—ã–±–Ω—É–ª—Å—è",
    saveBtn: "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
    shareBtn: "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
    donateText: "–ó–∞—Å—Ç–∞–≤–∏–ª–æ —É–ª—ã–±–Ω—É—Ç—å—Å—è? –£–≥–æ—Å—Ç–∏ –∏—Ö ‚òï",
    stats: "–¢–≤–æ–∏ —É–ª—ã–±–∫–∏:",
    about: "–û –Ω–∞—Å",
    privacy: "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å"
  },
  he: {
    topPlaceholder: "◊ò◊ß◊°◊ò ◊¢◊ú◊ô◊ï◊ü‚Ä¶",
    bottomPlaceholder: "◊ò◊ß◊°◊ò ◊™◊ó◊™◊ï◊ü‚Ä¶",
    randomBtn: "‚ú® ◊õ◊ô◊™◊ï◊ë ◊ó◊û◊ï◊ì",
    smileBtn: "üôÇ ◊ó◊ô◊ô◊õ◊™◊ô",
    saveBtn: "üíæ ◊©◊û◊ï◊® ◊™◊û◊ï◊†◊î",
    shareBtn: "üì§ ◊©◊™◊£",
    donateText: "◊í◊®◊ù ◊ú◊ö ◊ú◊ó◊ô◊ô◊ö? ◊™◊í◊û◊ú ◊ê◊ï◊™◊ù ‚òï",
    stats: "◊î◊ó◊ô◊ï◊õ◊ô◊ù ◊©◊ú◊ö:",
    about: "◊ê◊ï◊ì◊ï◊™",
    privacy: "◊§◊®◊ò◊ô◊ï◊™"
  },
  de: {
    topPlaceholder: "Oberer Text‚Ä¶",
    bottomPlaceholder: "Unterer Text‚Ä¶",
    randomBtn: "‚ú® S√º√üe Beschriftung",
    smileBtn: "üôÇ Ich habe gel√§chelt",
    saveBtn: "üíæ Bild speichern",
    shareBtn: "üì§ Teilen",
    donateText: "Hast du gel√§chelt? Belohne sie ‚òï",
    stats: "Deine L√§cheln:",
    about: "√úber",
    privacy: "Datenschutz"
  },
  cs: {
    topPlaceholder: "Horn√≠ text‚Ä¶",
    bottomPlaceholder: "Doln√≠ text‚Ä¶",
    randomBtn: "‚ú® Roztomil√Ω popisek",
    smileBtn: "üôÇ Usm√°l jsem se",
    saveBtn: "üíæ Ulo≈æit obr√°zek",
    shareBtn: "üì§ Sd√≠let",
    donateText: "Rozesm√°lo tƒõ to? Odmƒõ≈à je ‚òï",
    stats: "Tv√© √∫smƒõvy:",
    about: "O n√°s",
    privacy: "Soukrom√≠"
  }
};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const topInput = document.getElementById("topText");
const bottomInput = document.getElementById("bottomText");
const localEl = document.getElementById("local");

let currentImage = new Image();
let imageLoaded = false;
let currentImageIndex = 0;

// Set up image load handlers
currentImage.onload = function() {
  imageLoaded = true;
  console.log("Image loaded:", currentImage.src);
  draw();
};

currentImage.onerror = function() {
  console.error("Failed to load image:", currentImage.src);
  imageLoaded = false;
  // Try next image as fallback
  const currentIndex = images.findIndex(img => currentImage.src.includes(img));
  const nextIndex = (currentIndex + 1) % images.length;
  const src = images[nextIndex] + "?v=" + Date.now();
  console.log("Trying fallback image:", src);
  currentImage.src = src;
};

// Load image by index
function loadImageByIndex(index) {
  currentImageIndex = index;
  const src = images[currentImageIndex] + "?v=" + Date.now(); // Cache busting
  imageLoaded = false;
  console.log("Loading image:", src);
  currentImage.src = src;
}

// Load random image
function pickRandomImage() {
  const randomIndex = Math.floor(Math.random() * images.length);
  currentImageIndex = randomIndex;
  loadImageByIndex(randomIndex);
}

// Load next image
function loadNextImage() {
  currentImageIndex = (currentImageIndex + 1) % images.length;
  loadImageByIndex(currentImageIndex);
}

// Load previous image
function loadPrevImage() {
  currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
  loadImageByIndex(currentImageIndex);
}

// Draw everything on canvas
function draw() {
  if (!imageLoaded || !currentImage.complete || currentImage.width === 0) {
    return;
  }

  // Clear canvas with white background
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, 900, 900);

  // Calculate image dimensions to fit centered
  const maxSize = 800;
  const scale = Math.min(maxSize / currentImage.width, maxSize / currentImage.height);
  const width = currentImage.width * scale;
  const height = currentImage.height * scale;
  const x = (900 - width) / 2;
  const y = (900 - height) / 2;

  // Draw image centered
  ctx.drawImage(currentImage, x, y, width, height);

  // Draw captions
  drawCaption(topInput.value, 25, false);
  drawCaption(bottomInput.value, 875, true);

  // Draw watermark
  ctx.fillStyle = "rgba(0, 0, 0, 0.3)";
  ctx.font = "18px Inter";
  ctx.textAlign = "right";
  ctx.textBaseline = "bottom";
  ctx.fillText("justsmile4u.com", 880, 880);
}

// Draw caption with auto-scaling text
function drawCaption(text, y, isBottom) {
  if (!text) return;

  const padding = 20;
  const maxWidth = 780;
  const minFontSize = 32;
  const maxFontSize = 72;
  const lineHeight = 1.2;

  ctx.textAlign = "center";
  ctx.textBaseline = isBottom ? "bottom" : "top";
  ctx.font = `800 ${maxFontSize}px Inter`;

  // Measure text and calculate font size
  let fontSize = maxFontSize;
  let metrics = ctx.measureText(text);
  
  while (metrics.width > maxWidth && fontSize > minFontSize) {
    fontSize -= 2;
    ctx.font = `800 ${fontSize}px Inter`;
    metrics = ctx.measureText(text);
  }

  // Calculate text dimensions
  const textHeight = fontSize * lineHeight;
  const boxHeight = textHeight + padding * 2;
  const boxY = isBottom ? y - boxHeight : y;

  // Draw white rounded background
  const cornerRadius = 12;
  const boxX = 60;
  const boxWidth = maxWidth;

  ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
  roundRect(ctx, boxX, boxY, boxWidth, boxHeight, cornerRadius);
  ctx.fill();

  // Draw text with stroke for better readability
  const textY = isBottom ? y - padding - fontSize * 0.1 : y + padding + fontSize * 0.9;
  
  ctx.fillStyle = "#111827";
  ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
  ctx.lineWidth = 3;
  ctx.lineJoin = "round";
  ctx.miterLimit = 2;
  
  ctx.strokeText(text, 450, textY);
  ctx.fillText(text, 450, textY);
}

// Helper function to draw rounded rectangle
function roundRect(ctx, x, y, width, height, radius) {
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}

// Event listeners
topInput.addEventListener("input", draw);
bottomInput.addEventListener("input", draw);

// Language management
let currentLang = localStorage.getItem("language") || "en";

function updateLanguage() {
  const t = translations[currentLang];
  const cuteList = cute[currentLang] || cute.en;
  
  topInput.placeholder = t.topPlaceholder;
  bottomInput.placeholder = t.bottomPlaceholder;
  document.getElementById("randomBtn").textContent = t.randomBtn;
  document.getElementById("smileBtn").textContent = t.smileBtn;
  document.getElementById("saveBtn").textContent = t.saveBtn;
  document.getElementById("shareBtn").textContent = t.shareBtn;
  document.querySelector('a[href*="buymeacoffee"]').textContent = t.donateText;
  const statsText = document.querySelector(".stats");
  if (statsText) {
    statsText.innerHTML = t.stats + ' <b id="local">' + (localStorage.getItem("smiles") || "0") + "</b>";
    // Update localEl reference
    const newLocalEl = document.getElementById("local");
    if (newLocalEl) {
      window.localEl = newLocalEl;
    }
  }
  document.querySelector('footer a[href="about.html"]').textContent = t.about;
  document.querySelector('footer a[href="privacy.html"]').textContent = t.privacy;
  const langSelect = document.getElementById("languageSelect");
  if (langSelect) {
    langSelect.value = currentLang;
  }
  
  // Store cute captions for current language
  window.currentCuteList = cuteList;
}

const langSelect = document.getElementById("languageSelect");
if (langSelect) {
  langSelect.addEventListener("change", function() {
    currentLang = this.value;
    localStorage.setItem("language", currentLang);
    updateLanguage();
  });
}

document.getElementById("randomBtn").onclick = function() {
  const cuteList = window.currentCuteList || cute[currentLang] || cute.en;
  const pair = cuteList[Math.floor(Math.random() * cuteList.length)];
  topInput.value = pair[0];
  bottomInput.value = pair[1];
  draw();
};

document.getElementById("smileBtn").onclick = function() {
  let count = parseInt(localStorage.getItem("smiles") || "0", 10);
  count++;
  localStorage.setItem("smiles", count.toString());
  const localElRef = window.localEl || localEl;
  if (localElRef) {
    localElRef.textContent = count;
  }
  loadNextImage();
};

document.getElementById("saveBtn").onclick = function() {
  const link = document.createElement("a");
  link.download = "justsmile4u.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};

document.getElementById("shareBtn").onclick = async function() {
  if (!navigator.share) {
    alert("Sharing is not supported in your browser.");
    return;
  }

  try {
    canvas.toBlob(function(blob) {
      const file = new File([blob], "justsmile4u.png", { type: "image/png" });
      navigator.share({
        files: [file],
        title: "Just Smile 4 You",
        text: "Made with justsmile4u.com"
      }).catch(function(err) {
        if (err.name !== "AbortError") {
          console.error("Error sharing:", err);
        }
      });
    });
  } catch (err) {
    console.error("Error creating share:", err);
    alert("Unable to share. Please try saving the image instead.");
  }
};

// Navigation buttons handlers
document.getElementById("prevBtn").onclick = function() {
  loadPrevImage();
};

document.getElementById("nextBtn").onclick = function() {
  loadNextImage();
};

// Initialize
updateLanguage();
const localElRef = window.localEl || localEl;
if (localElRef) {
  localElRef.textContent = localStorage.getItem("smiles") || "0";
}
// Initialize with random image and set index
currentImageIndex = Math.floor(Math.random() * images.length);
loadImageByIndex(currentImageIndex);
</script>
</body>
</html>
