<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Just Smile 4 You</title>
<meta name="description" content="A tiny site to make you smile."/>

<link rel="icon" type="image/png" href="img/axolotl-hug - Copy.png">
<link rel="shortcut icon" type="image/png" href="img/axolotl-hug - Copy.png">
<link rel="apple-touch-icon" href="img/axolotl-hug - Copy.png">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- AdSense -->
<script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8042664823664503"
  crossorigin="anonymous"></script>

<style>
:root{
 --border:#e5e7eb; --text:#111827; --muted:#6b7280;
}
body{margin:0;font-family:Inter,system-ui;background:#fff;color:var(--text)}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.page{max-width:980px;width:100%}
.grid{display:grid;grid-template-columns:1fr min(420px,100%) 1fr;gap:14px}
.ad{border:1px dashed var(--border);border-radius:16px;min-height:140px;
padding:10px;display:block;color:var(--muted)}
.ad .adsbygoogle{display:block;width:100% !important}
.center{border:1px solid var(--border);border-radius:22px;padding:16px;background:#fff;position:relative}
canvas{width:100%;height:auto;display:block;border-radius:8px}
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:16px}
input{flex:1;min-width:200px;border:1px solid var(--border);border-radius:999px;padding:12px 16px;
font-weight:400;background:#fff;font-size:14px;font-family:Inter}
input:focus{outline:none;border-color:#9ca3af}
button,a{border:1px solid var(--border);border-radius:999px;padding:12px 16px;
font-weight:600;background:#fff;font-size:14px;cursor:pointer;text-decoration:none;color:var(--text);
font-family:Inter;transition:background 0.2s}
button:hover,a:hover{background:#f9fafb}
button:active{background:#f3f4f6}
#prevBtn,#nextBtn{width:44px;height:44px;padding:0;display:flex;align-items:center;justify-content:center;
font-size:20px;border-radius:50%;position:absolute;bottom:20px;z-index:10}
#prevBtn{left:20px}
#nextBtn{right:20px}
.stats{text-align:center;color:var(--muted);font-size:14px;margin-top:16px}
.language-selector{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;flex-wrap:wrap}
.language-selector select{border:1px solid var(--border);border-radius:999px;padding:8px 16px;
font-weight:400;background:#fff;font-size:14px;font-family:Inter;cursor:pointer;color:var(--text)}
.language-selector select:focus{outline:none;border-color:#9ca3af}
footer{text-align:center;font-size:12px;color:var(--muted);margin-top:20px}
footer a{color:var(--muted);text-decoration:none;padding:4px 8px;border-radius:4px}
footer a:hover{color:var(--text);background:#f9fafb}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
  .ad{display:none}
}
</style>
</head>

<body>
<div class="wrap">
<div class="page">

<div class="grid">
  <div class="ad">
    <!-- Block1 -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8042664823664503"
         data-ad-slot="2042270942"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         if (window.innerWidth > 900) {
           setTimeout(() => {
             (adsbygoogle = window.adsbygoogle || []).push({});
           }, 0);
         }
    </script>
  </div>

  <div class="center">
    <canvas id="canvas" width="900" height="900"></canvas>
    <button id="prevBtn" title="Previous image">â—€</button>
    <button id="nextBtn" title="Next image">â–¶</button>

    <div class="controls">
      <input id="topText" placeholder="Top textâ€¦" maxlength="40">
      <input id="bottomText" placeholder="Bottom textâ€¦" maxlength="40">
      <button id="randomBtn">âœ¨ Cute caption</button>
      <button id="smileBtn">ğŸ™‚ I smiled</button>
      <button id="saveBtn">ğŸ’¾ Save image</button>
      <button id="shareBtn">ğŸ“¤ Share</button>
      <a href="https://buymeacoffee.com/justsmile4u" target="_blank">Made you smile? Treat them â˜•</a>
    </div>

    <div class="language-selector">
      <span>ğŸŒ</span>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="he">×¢×‘×¨×™×ª</option>
        <option value="de">Deutsch</option>
        <option value="cs">ÄŒeÅ¡tina</option>
      </select>
    </div>

    <div class="stats">
      Your smiles: <b id="local">0</b>
    </div>
  </div>

  <div class="ad">
    <!-- Block2 -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8042664823664503"
         data-ad-slot="3158049672"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         if (window.innerWidth > 900) {
           setTimeout(() => {
             (adsbygoogle = window.adsbygoogle || []).push({});
           }, 0);
         }
    </script>
  </div>
</div>

<footer>
<a href="about.html">About</a> Â· <a href="privacy.html">Privacy</a>
</footer>

</div>
</div>

<script>
const images = [
  "img/cat-hug.png",
  "img/dog-hug.png",
  "img/axolotl-hug.png",
  "img/axolotl-hug - Copy.png",
  "img/pomeranian-hug.png",
  "img/scottish_fold-hug.png",
  "img/dwarf_rabbit-hug.png",
  "img/guinea_pig-hug.png",
  "img/chinchilla-hug.png",
  "img/corgi-hug.png",
  "img/red_panda-hug.png",
  "img/quokka-hug.png",
  "img/fennec-hug.png",
  "img/manul-hug.png",
  "img/japanese_flying_squirrel-hug.png",
  "img/dormouse-hug.png",
  "img/ermine-hug.png",
  "img/raccoon-hug.png",
  "img/baby_seal-hug.png",
  "img/sea_otter-hug.png",
  "img/baby_penguin-hug.png",
  "img/degu-hug.png",
  "img/sloth-hug.png",
  "img/loris-hug.png",
  "img/koala-hug.png",
  "img/pygmy_marmoset-hug.png",
  "img/wombat-hug.png",
  "img/tarsier-hug.png",
  "img/tree_kangaroo-hug.png",
  "img/mini_pig-hug.png",
  "img/alpaca-hug.png",
  "img/pygmy_goat-hug.png",
  "img/highland_calf-hug.png",
  "img/panda-hug.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_36 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_38 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_41 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_43 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_44 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_46 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_47 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_49 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_51 PM.png",
  "img/ChatGPT Image Jan 14, 2026, 05_33_52 PM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_10_11 AM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_11_37 AM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_11_43 AM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_12_48 AM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_18_14 AM.png",
  "img/ChatGPT Image Jan 15, 2026, 01_19_27 AM.png"
];
const cute = {
  en: [
    ["i need a hug", "just a little"],
    ["everything is fine", "probably"],
    ["sending you", "a tiny hug"],
    ["no thoughts", "only feelings"],
    ["you're doing great", "keep going"],
    ["take a breath", "you've got this"],
    ["sending love", "your way"],
    ["it's okay", "to rest"],
    ["you are loved", "more than you know"],
    ["today might be hard", "but you're stronger"],
    ["small steps", "big progress"],
    ["you matter", "always"],
    ["be kind", "to yourself"],
    ["it's okay", "to feel"],
    ["you're enough", "just as you are"],
    ["take your time", "there's no rush"]
  ],
  ru: [
    ["Ğ¼Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ¾Ğ±ÑŠÑÑ‚Ğ¸Ñ", "ÑĞ¾Ğ²ÑĞµĞ¼ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ"],
    ["Ğ²ÑÑ‘ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾", "Ğ½Ğ°Ğ²ĞµÑ€Ğ½Ğ¾Ğµ"],
    ["Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ Ñ‚ĞµĞ±Ğµ", "ĞºÑ€Ğ¾ÑˆĞµÑ‡Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑŠÑÑ‚Ğ¸Ğµ"],
    ["Ğ½ĞµÑ‚ Ğ¼Ñ‹ÑĞ»ĞµĞ¹", "Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°"],
    ["Ñƒ Ñ‚ĞµĞ±Ñ Ğ²ÑÑ‘ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾", "Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹"],
    ["ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ²Ğ´Ğ¾Ñ…", "Ñ‚Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸ÑˆÑŒÑÑ"],
    ["Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ Ğ»ÑĞ±Ğ¾Ğ²ÑŒ", "Ñ‚ĞµĞ±Ğµ"],
    ["Ğ²ÑÑ‘ Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ", "Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ"],
    ["Ñ‚ĞµĞ±Ñ Ğ»ÑĞ±ÑÑ‚", "Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‡ĞµĞ¼ Ñ‚Ñ‹ Ğ·Ğ½Ğ°ĞµÑˆÑŒ"],
    ["ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾", "Ğ½Ğ¾ Ñ‚Ñ‹ ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ"],
    ["Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ ÑˆĞ°Ğ³Ğ¸", "Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ"],
    ["Ñ‚Ñ‹ Ğ²Ğ°Ğ¶ĞµĞ½", "Ğ²ÑĞµĞ³Ğ´Ğ°"],
    ["Ğ±ÑƒĞ´ÑŒ Ğ´Ğ¾Ğ±Ñ€", "Ğº ÑĞµĞ±Ğµ"],
    ["ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾", "Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ"],
    ["Ñ‚Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡ĞµĞ½", "Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¸Ğ¼, ĞºĞ°ĞºĞ¾Ğ¹ ĞµÑÑ‚ÑŒ"],
    ["Ğ½Ğµ Ñ‚Ğ¾Ñ€Ğ¾Ğ¿Ğ¸ÑÑŒ", "Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾"]
  ],
  he: [
    ["×× ×™ ×¦×¨×™×š ×—×™×‘×•×§", "×¨×§ ×§×¦×ª"],
    ["×”×›×œ ×‘×¡×“×¨", "×›× ×¨××”"],
    ["×©×•×œ×— ×œ×š", "×—×™×‘×•×§ ×§×˜×Ÿ"],
    ["××™×Ÿ ××—×©×‘×•×ª", "×¨×§ ×¨×’×©×•×ª"],
    ["××ª×” ××¦×•×™×Ÿ", "×ª××©×™×š"],
    ["×§×— × ×©×™××”", "×ª×¦×œ×™×—"],
    ["×©×•×œ×— ××”×‘×”", "×“×¨×›×š"],
    ["×–×” ×‘×¡×“×¨", "×œ× ×•×—"],
    ["××ª×” ××”×•×‘", "×™×•×ª×¨ ×××” ×©××ª×” ×™×•×“×¢"],
    ["×”×™×•× ×™×›×•×œ ×œ×”×™×•×ª ×§×©×”", "××‘×œ ××ª×” ×—×–×§ ×™×•×ª×¨"],
    ["×¦×¢×“×™× ×§×˜× ×™×", "×”×ª×§×“××•×ª ×’×“×•×œ×”"],
    ["××ª×” ×—×©×•×‘", "×ª××™×“"],
    ["×”×™×” ×˜×•×‘", "×œ×¢×¦××š"],
    ["×–×” ×‘×¡×“×¨", "×œ×”×¨×’×™×©"],
    ["××ª×” ××¡×¤×™×§", "×‘×“×™×•×§ ×›××• ×©××ª×”"],
    ["×§×— ××ª ×”×–××Ÿ ×©×œ×š", "××™×Ÿ ×¦×•×¨×š ×œ××”×¨"]
  ],
  de: [
    ["ich brauche eine umarmung", "nur ein bisschen"],
    ["alles ist gut", "wahrscheinlich"],
    ["sende dir", "eine kleine umarmung"],
    ["keine gedanken", "nur gefÃ¼hle"],
    ["du machst das groÃŸartig", "mach weiter"],
    ["atme durch", "du schaffst das"],
    ["sende liebe", "deinen weg"],
    ["es ist okay", "sich auszuruhen"],
    ["du bist geliebt", "mehr als du weiÃŸt"],
    ["heute kÃ¶nnte schwer sein", "aber du bist stÃ¤rker"],
    ["kleine schritte", "groÃŸer fortschritt"],
    ["du zÃ¤hlst", "immer"],
    ["sei nett", "zu dir selbst"],
    ["es ist okay", "zu fÃ¼hlen"],
    ["du bist genug", "genau so wie du bist"],
    ["nimm dir zeit", "es gibt keine eile"]
  ],
  cs: [
    ["potÅ™ebuji objetÃ­", "jen trochu"],
    ["vÅ¡echno je v poÅ™Ã¡dku", "pravdÄ›podobnÄ›"],
    ["posÃ­lÃ¡m ti", "malÃ© objetÃ­"],
    ["Å¾Ã¡dnÃ© myÅ¡lenky", "jen pocity"],
    ["jde ti to skvÄ›le", "pokraÄuj"],
    ["zhluboka se nadechni", "zvlÃ¡dneÅ¡ to"],
    ["posÃ­lÃ¡m lÃ¡sku", "tvou cestou"],
    ["je to v poÅ™Ã¡dku", "odpoÄinout si"],
    ["jsi milovÃ¡n", "vÃ­ce neÅ¾ vÃ­Å¡"],
    ["dnes mÅ¯Å¾e bÃ½t tÄ›Å¾kÃ©", "ale jsi silnÄ›jÅ¡Ã­"],
    ["malÃ© kroky", "velkÃ½ pokrok"],
    ["zÃ¡leÅ¾Ã­Å¡ na tom", "vÅ¾dy"],
    ["buÄ laskavÃ½", "k sobÄ›"],
    ["je to v poÅ™Ã¡dku", "cÃ­tit"],
    ["jsi dostateÄnÃ½", "pÅ™esnÄ› takovÃ½, jakÃ½ jsi"],
    ["dopÅ™ej si Äas", "nenÃ­ kam spÄ›chat"]
  ]
};

// Translations
const translations = {
  en: {
    topPlaceholder: "Top textâ€¦",
    bottomPlaceholder: "Bottom textâ€¦",
    randomBtn: "âœ¨ Cute caption",
    smileBtn: "ğŸ™‚ I smiled",
    saveBtn: "ğŸ’¾ Save image",
    shareBtn: "ğŸ“¤ Share",
    donateText: "Made you smile? Treat them â˜•",
    stats: "Your smiles:",
    about: "About",
    privacy: "Privacy"
  },
  ru: {
    topPlaceholder: "Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚â€¦",
    bottomPlaceholder: "ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚â€¦",
    randomBtn: "âœ¨ ĞœĞ¸Ğ»Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ",
    smileBtn: "ğŸ™‚ Ğ¯ ÑƒĞ»Ñ‹Ğ±Ğ½ÑƒĞ»ÑÑ",
    saveBtn: "ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ",
    shareBtn: "ğŸ“¤ ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
    donateText: "Ğ—Ğ°ÑÑ‚Ğ°Ğ²Ğ¸Ğ»Ğ¾ ÑƒĞ»Ñ‹Ğ±Ğ½ÑƒÑ‚ÑŒÑÑ? Ğ£Ğ³Ğ¾ÑÑ‚Ğ¸ Ğ¸Ñ… â˜•",
    stats: "Ğ¢Ğ²Ğ¾Ğ¸ ÑƒĞ»Ñ‹Ğ±ĞºĞ¸:",
    about: "Ğ Ğ½Ğ°Ñ",
    privacy: "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ"
  },
  he: {
    topPlaceholder: "×˜×§×¡×˜ ×¢×œ×™×•×Ÿâ€¦",
    bottomPlaceholder: "×˜×§×¡×˜ ×ª×—×ª×•×Ÿâ€¦",
    randomBtn: "âœ¨ ×›×™×ª×•×‘ ×—××•×“",
    smileBtn: "ğŸ™‚ ×—×™×™×›×ª×™",
    saveBtn: "ğŸ’¾ ×©××•×¨ ×ª××•× ×”",
    shareBtn: "ğŸ“¤ ×©×ª×£",
    donateText: "×’×¨× ×œ×š ×œ×—×™×™×š? ×ª×’××œ ××•×ª× â˜•",
    stats: "×”×—×™×•×›×™× ×©×œ×š:",
    about: "××•×“×•×ª",
    privacy: "×¤×¨×˜×™×•×ª"
  },
  de: {
    topPlaceholder: "Oberer Textâ€¦",
    bottomPlaceholder: "Unterer Textâ€¦",
    randomBtn: "âœ¨ SÃ¼ÃŸe Beschriftung",
    smileBtn: "ğŸ™‚ Ich habe gelÃ¤chelt",
    saveBtn: "ğŸ’¾ Bild speichern",
    shareBtn: "ğŸ“¤ Teilen",
    donateText: "Hast du gelÃ¤chelt? Belohne sie â˜•",
    stats: "Deine LÃ¤cheln:",
    about: "Ãœber",
    privacy: "Datenschutz"
  },
  cs: {
    topPlaceholder: "HornÃ­ textâ€¦",
    bottomPlaceholder: "DolnÃ­ textâ€¦",
    randomBtn: "âœ¨ RoztomilÃ½ popisek",
    smileBtn: "ğŸ™‚ UsmÃ¡l jsem se",
    saveBtn: "ğŸ’¾ UloÅ¾it obrÃ¡zek",
    shareBtn: "ğŸ“¤ SdÃ­let",
    donateText: "RozesmÃ¡lo tÄ› to? OdmÄ›Åˆ je â˜•",
    stats: "TvÃ© ÃºsmÄ›vy:",
    about: "O nÃ¡s",
    privacy: "SoukromÃ­"
  }
};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const topInput = document.getElementById("topText");
const bottomInput = document.getElementById("bottomText");
const localEl = document.getElementById("local");

let currentImage = new Image();
let imageLoaded = false;
let currentImageIndex = 0;

// Smart random system to avoid repeats
let shownIndices = []; // Track shown images
let availableIndices = []; // Pool of available indices
const MIN_UNIQUE_BEFORE_REPEAT = 30; // Minimum unique images before allowing repeats

// Initialize available indices array
function initAvailableIndices() {
  availableIndices = [];
  for (let i = 0; i < images.length; i++) {
    availableIndices.push(i);
  }
  shuffleArray(availableIndices);
}

// Fisher-Yates shuffle algorithm
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Get next random image without repeats
function getNextRandomIndex() {
  // If we've shown enough unique images, reset the tracking
  if (shownIndices.length >= MIN_UNIQUE_BEFORE_REPEAT) {
    shownIndices = [];
  }
  
  // If available pool is empty, reinitialize it
  if (availableIndices.length === 0) {
    initAvailableIndices();
  }
  
  // Get next index from pool
  let nextIndex = availableIndices.shift();
  
  // If this index was shown recently, try to find another one
  if (shownIndices.includes(nextIndex) && availableIndices.length > 0) {
    // Try to find an unshown index
    let foundUnshown = false;
    for (let i = 0; i < availableIndices.length; i++) {
      if (!shownIndices.includes(availableIndices[i])) {
        nextIndex = availableIndices.splice(i, 1)[0];
        foundUnshown = true;
        break;
      }
    }
    // If all remaining are shown, just use the first one
    if (!foundUnshown && availableIndices.length > 0) {
      nextIndex = availableIndices.shift();
    }
  }
  
  // Track this index as shown
  if (!shownIndices.includes(nextIndex)) {
    shownIndices.push(nextIndex);
  }
  
  return nextIndex;
}

// Set up image load handlers
currentImage.onload = function() {
  imageLoaded = true;
  console.log("Image loaded:", currentImage.src);
  draw();
};

currentImage.onerror = function() {
  console.error("Failed to load image:", currentImage.src);
  imageLoaded = false;
  // Try next image as fallback
  const currentIndex = images.findIndex(img => currentImage.src.includes(img));
  const nextIndex = (currentIndex + 1) % images.length;
  const src = images[nextIndex] + "?v=" + Date.now();
  console.log("Trying fallback image:", src);
  currentImage.src = src;
};

// Load image by index
function loadImageByIndex(index) {
  currentImageIndex = index;
  const src = images[currentImageIndex] + "?v=" + Date.now(); // Cache busting
  imageLoaded = false;
  console.log("Loading image:", src);
  currentImage.src = src;
}

// Load random image (smart random)
function pickRandomImage() {
  const randomIndex = getNextRandomIndex();
  currentImageIndex = randomIndex;
  loadImageByIndex(randomIndex);
}

// Load next image (smart random)
function loadNextImage() {
  const randomIndex = getNextRandomIndex();
  currentImageIndex = randomIndex;
  loadImageByIndex(currentImageIndex);
}

// Load previous image (smart random)
function loadPrevImage() {
  const randomIndex = getNextRandomIndex();
  currentImageIndex = randomIndex;
  loadImageByIndex(currentImageIndex);
}

// Draw everything on canvas
function draw() {
  if (!imageLoaded || !currentImage.complete || currentImage.width === 0) {
    return;
  }

  // Clear canvas with white background
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, 900, 900);

  // Calculate image dimensions to fit centered
  const maxSize = 800;
  const scale = Math.min(maxSize / currentImage.width, maxSize / currentImage.height);
  const width = currentImage.width * scale;
  const height = currentImage.height * scale;
  const x = (900 - width) / 2;
  const y = (900 - height) / 2;

  // Draw image centered
  ctx.drawImage(currentImage, x, y, width, height);

  // Draw captions
  drawCaption(topInput.value, 25, false);
  drawCaption(bottomInput.value, 875, true);

  // Draw watermark
  ctx.fillStyle = "rgba(0, 0, 0, 0.3)";
  ctx.font = "18px Inter";
  ctx.textAlign = "right";
  ctx.textBaseline = "bottom";
  ctx.fillText("justsmile4u.com", 880, 880);
}

// Draw caption with auto-scaling text
function drawCaption(text, y, isBottom) {
  if (!text) return;

  const padding = 20;
  const maxWidth = 780;
  const minFontSize = 32;
  const maxFontSize = 72;
  const lineHeight = 1.2;

  ctx.textAlign = "center";
  ctx.textBaseline = isBottom ? "bottom" : "top";
  ctx.font = `800 ${maxFontSize}px Inter`;

  // Measure text and calculate font size
  let fontSize = maxFontSize;
  let metrics = ctx.measureText(text);
  
  while (metrics.width > maxWidth && fontSize > minFontSize) {
    fontSize -= 2;
    ctx.font = `800 ${fontSize}px Inter`;
    metrics = ctx.measureText(text);
  }

  // Calculate text dimensions
  const textHeight = fontSize * lineHeight;
  const boxHeight = textHeight + padding * 2;
  const boxY = isBottom ? y - boxHeight : y;

  // Draw white rounded background
  const cornerRadius = 12;
  const boxX = 60;
  const boxWidth = maxWidth;

  ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
  roundRect(ctx, boxX, boxY, boxWidth, boxHeight, cornerRadius);
  ctx.fill();

  // Draw text with stroke for better readability
  const textY = isBottom ? y - padding - fontSize * 0.1 : y + padding + fontSize * 0.9;
  
  ctx.fillStyle = "#111827";
  ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
  ctx.lineWidth = 3;
  ctx.lineJoin = "round";
  ctx.miterLimit = 2;
  
  ctx.strokeText(text, 450, textY);
  ctx.fillText(text, 450, textY);
}

// Helper function to draw rounded rectangle
function roundRect(ctx, x, y, width, height, radius) {
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}

// Event listeners
topInput.addEventListener("input", draw);
bottomInput.addEventListener("input", draw);

// Language management
let currentLang = localStorage.getItem("language") || "en";

function updateLanguage() {
  const t = translations[currentLang];
  const cuteList = cute[currentLang] || cute.en;
  
  topInput.placeholder = t.topPlaceholder;
  bottomInput.placeholder = t.bottomPlaceholder;
  document.getElementById("randomBtn").textContent = t.randomBtn;
  document.getElementById("smileBtn").textContent = t.smileBtn;
  document.getElementById("saveBtn").textContent = t.saveBtn;
  document.getElementById("shareBtn").textContent = t.shareBtn;
  document.querySelector('a[href*="buymeacoffee"]').textContent = t.donateText;
  const statsText = document.querySelector(".stats");
  if (statsText) {
    statsText.innerHTML = t.stats + ' <b id="local">' + (localStorage.getItem("smiles") || "0") + "</b>";
    // Update localEl reference
    const newLocalEl = document.getElementById("local");
    if (newLocalEl) {
      window.localEl = newLocalEl;
    }
  }
  document.querySelector('footer a[href="about.html"]').textContent = t.about;
  document.querySelector('footer a[href="privacy.html"]').textContent = t.privacy;
  const langSelect = document.getElementById("languageSelect");
  if (langSelect) {
    langSelect.value = currentLang;
  }
  
  // Store cute captions for current language
  window.currentCuteList = cuteList;
}

const langSelect = document.getElementById("languageSelect");
if (langSelect) {
  langSelect.addEventListener("change", function() {
    currentLang = this.value;
    localStorage.setItem("language", currentLang);
    updateLanguage();
  });
}

document.getElementById("randomBtn").onclick = function() {
  const cuteList = window.currentCuteList || cute[currentLang] || cute.en;
  const pair = cuteList[Math.floor(Math.random() * cuteList.length)];
  topInput.value = pair[0];
  bottomInput.value = pair[1];
  draw();
};

document.getElementById("smileBtn").onclick = function() {
  let count = parseInt(localStorage.getItem("smiles") || "0", 10);
  count++;
  localStorage.setItem("smiles", count.toString());
  const localElRef = window.localEl || localEl;
  if (localElRef) {
    localElRef.textContent = count;
  }
  loadNextImage();
};

document.getElementById("saveBtn").onclick = function() {
  const link = document.createElement("a");
  link.download = "justsmile4u.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};

document.getElementById("shareBtn").onclick = async function() {
  if (!navigator.share) {
    alert("Sharing is not supported in your browser.");
    return;
  }

  try {
    canvas.toBlob(function(blob) {
      const file = new File([blob], "justsmile4u.png", { type: "image/png" });
      navigator.share({
        files: [file],
        title: "Just Smile 4 You",
        text: "Made with justsmile4u.com"
      }).catch(function(err) {
        if (err.name !== "AbortError") {
          console.error("Error sharing:", err);
        }
      });
    });
  } catch (err) {
    console.error("Error creating share:", err);
    alert("Unable to share. Please try saving the image instead.");
  }
};

// Navigation buttons handlers
document.getElementById("prevBtn").onclick = function() {
  loadPrevImage();
};

document.getElementById("nextBtn").onclick = function() {
  loadNextImage();
};

// Initialize
updateLanguage();
const localElRef = window.localEl || localEl;
if (localElRef) {
  localElRef.textContent = localStorage.getItem("smiles") || "0";
}
// Initialize smart random system
initAvailableIndices();

// Initialize with random image and set index
const initialIndex = getNextRandomIndex();
currentImageIndex = initialIndex;
loadImageByIndex(currentImageIndex);
</script>
</body>
</html>
